
<div class="page-content header-clear-medium">
  
        
  <div class="card card-style text-center">
      <div class="content">
          <h2 class="mb-8">
              Checkout
          </h2>
          <p>Your shopping cart before checking out.<br><em><strong>One Click Purchase</strong></em></p>
      </div>
  </div>
  <div class="card card-style">
      <div class="content">
          <% @cart['carts'].map{|c,i| c['cart']}.each_with_index do |stored, indx| %>
            <% stored.each do |cart| %>
              <div class="mb-4">
                <div class="mr-3">
                  <h5 class="mb-4 font-600"><%= link_to cart['stripeProductInfo']['name'].titleize, service_path(id: cart['stripeProductInfo']['id'][5..cart['stripeProductInfo']['id'].size], connectAccount: @cart['carts'][indx]['connectAccount'])%></h5>
                  <% if !cart['stripePriceInfo']['transform_quantity'].blank? %>
                    <p class="mt-n1 font-12 color-highlight mb-4" id='packageSelected'><i class="fa fa-info mr-3"></i><%= "Package of #{cart['stripePriceInfo']['transform_quantity']['divide_by']}"%></p>
                  <% end %>
                  <%= form_for :addToCart, :html => {:id => cart['stripePriceInfo']['id']}, url: updateQuantity_path(id: @cart['carts'][indx]['connectAccount']) do |f| %>
                    <div class="row mb-0">
                      <div class="col-4">
                          <div class="input-style input-style-2">
                              <span class="input-style-1-active">Quantity</span>




                                <%= f.hidden_field :sellerItem, value: cart['stripePriceInfo']['id'] %>
                                <%= f.number_field :quantity, id: cart['stripePriceInfo']['id'], onchange: "packageOrNah(#{cart['stripePriceInfo']['id']});", value: cart['quantity'] %>
                                
                              






                          </div>
                      </div>
                      <div class="col-4">
                          <div class="input-style input-style-2">
                              <span class="input-style-1-active">Price</span>
                              <input placeholder="1" readonly="true" value="<%= number_to_currency(cart['stripePriceInfo']['unit_amount'] * 0.01, precision: 2) %>">
                          </div>
                      </div>
                      <div class="col-4">
                        <%= link_to "carts/#{@cart['carts'][indx]['connectAccount']}?item=#{cart['stripePriceInfo']['id']}", class: 'btn btn-full bg-red2-dark text-uppercase font-900 rounded-sm', 'style'=>"text-align: center;", method: :delete do %>
                           <i class="fa fa-times"></i>
                        <% end %>
                      </div>

                      <div id="showthis<%= cart['stripePriceInfo']['id'] %>" style="display: none;" class='mb-0 col-12'>
                        <%= f.submit "update", class: 'btn btn-full bg-yellow2-dark text-uppercase font-900 rounded-sm', 'style'=>"text-align: center;"  %>
                      </div>

                    </div>
                  <% end %>
                </div>
                <!-- <div class="ml-auto">
                    <img src="images/pictures/10s.jpg" class="rounded-m shadow-xl" width="130">
                </div> -->
              </div>
            <% end %>
          <% end %>
          

          <div class="divider"></div>
          <div class="d-flex mb-3">
              <div class="mr-3 text-left">
                  <h5 class="font-600">Fee &nbsp;<i class="fa fa-exclamation-circle font-14 mt-1 color-yellow2-dark scale-icon mr-2" data-toggle="tooltip" data-placement="right" title="" data-original-title="Miser Brands service fee includes processing fees"></i></h5>
                  <% if current_user&.stripeSourceVerified && !current_user&.member? %>
                    <h4 class="font-600 opacity-50">Save up to <%= number_to_currency((@cart['serviceFee'] * 0.71) * 0.01, precision: 2) %><br>
                      <a href="/membership">Become a Member &amp; Save</a>
                    </h4>
                  <% elsif current_user&.member? %>
                    <p class="font-600">You Saved <i class="fa fa-exclamation-circle font-14 mt-1 color-yellow2-dark scale-icon mr-2" data-toggle="tooltip" data-placement="right" title="" data-original-title="Transaction fees are lowered for members, enjoy your savings!"></i>
                    </p>
                  <% end %>

              </div>
              <div class="ml-auto text-right">
                  <h4><%= number_to_currency(@cart['serviceFee'] * 0.01, precision: 2) %></h4>

                  <% if current_user&.stripeSourceVerified && !current_user&.member? %>
                    <h4 class="opacity-50"><%= number_to_currency((@cart['serviceFee'] - (@cart['serviceFee'] * 0.71)) * 0.01, precision: 2) %></h4>
                  <% elsif current_user&.member? %>
                    <p><%= number_to_currency((((35 * 0.01) * @cart['subItemsTotal']) * 0.01) - ((@cart['servicePercent'] * @cart['subItemsTotal']) * 0.01), precision: 2) %></p>
                  <% end %>
              </div>
          </div>
          <div class="d-flex">
              <div class="mr-3 text-left">
                  <h5 class="font-600">Sub Total</h5>
              </div>
              <div class="ml-auto text-right">
                  <h4>
                    <%= number_to_currency(@cart['subItemsTotal'] * 0.01, precision: 2) %>
                  </h4>
              </div>
          </div>
          <div class="divider"></div>
          <div class="d-flex mb-3">
              <div class="mr-3 text-left">
                  <h4 class="font-20">Grand Total</h4>
              </div>
              <div class="ml-auto text-right">
                  <h4 class="font-20">
                    <%= number_to_currency(@cart['subTotal'] * 0.01, precision: 2) %>
                  </h4>
              </div>
          </div>
          
          <% if @cart['carts'].map{|c,i| c['cart']}.flatten.map{|c,i|c['quantity']}.sum != 0 %>

            <%= form_for :checkout, url: checkout_path do |f| %>
              <div class="input-style input-style-2">
                <%= f.submit "Charge Me", class: "btn btn-full bg-green1-dark text-uppercase rounded-sm font-900"%>
              </div>
                  
            <% end %>



          <% else %>
            <a href="/services" class="btn btn-full bg-blue2-dark btn-m text-uppercase font-800 rounded-sm">Continue Shopping</a>
          <% end %>
      </div>
  </div>
</div>


<script type="text/javascript">
  function packageOrNah(thisID) {
    // Get the checkbox
    var onOffDIV = document.getElementById("showthis"+thisID.id);

    // If the checkbox is checked, display the output text
      onOffDIV.style.display = "block";
      console.log(onOffDIV);
      console.log(thisID.id);
  }

</script>